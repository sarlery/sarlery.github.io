<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>readme | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="HTML5 File API在 HTML5 的 input 标签中，新增了一个 type=file 属性的表单控件。这个控件可以让我们能调出文件选择窗口然后读取这些文件的内容成为可能。   1&amp;lt;input type=&quot;file&quot; id=&quot;file-ipt&quot; name=&quot;file&quot; accept=&quot;.jpg,.jpeg,.gif,.png&quot;&amp;gt;  上面代码就是一个 file DOM。它支持">
<meta property="og:type" content="article">
<meta property="og:title" content="readme">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2019&#x2F;10&#x2F;23&#x2F;readme&#x2F;index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="HTML5 File API在 HTML5 的 input 标签中，新增了一个 type=file 属性的表单控件。这个控件可以让我们能调出文件选择窗口然后读取这些文件的内容成为可能。   1&amp;lt;input type=&quot;file&quot; id=&quot;file-ipt&quot; name=&quot;file&quot; accept=&quot;.jpg,.jpeg,.gif,.png&quot;&amp;gt;  上面代码就是一个 file DOM。它支持">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-10-23T01:55:38.267Z">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-readme" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/23/readme/" class="article-date">
  <time datetime="2019-10-23T01:55:12.772Z" itemprop="datePublished">2019-10-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      readme
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="HTML5-File-API"><a href="#HTML5-File-API" class="headerlink" title="HTML5 File API"></a>HTML5 File API</h1><p>在 HTML5 的 input 标签中，新增了一个 <code>type=file</code> 属性的表单控件。这个控件可以让我们能调出文件选择窗口然后读取这些文件的内容成为可能。  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"file-ipt"</span> <span class="attr">name</span>=<span class="string">"file"</span> <span class="attr">accept</span>=<span class="string">".jpg,.jpeg,.gif,.png"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面代码就是一个 file DOM。它支持选择以 .jpg、.gif、.png 后缀格式的图片。当选择好一个文件后 input 元素就会触发 change 事件。<br>该元素不仅可以点击选择文件，还支持拖拽选取文件。当将文件拖拽到 input 元素上方并松手后也会触发 change 事件。  </p>
<p>通过文件 API，我们可以访问 FileList，包含了代表用户所选文件的对象 File。  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fileIpt = <span class="built_in">document</span>.getElementById(<span class="string">"file-ipt"</span>);</span><br><span class="line"><span class="comment">// change 事件触发：</span></span><br><span class="line">fileIpt.onchange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> files = fileIpt.files;    <span class="comment">// 获取到 fileList</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>;i &lt; files.length;i ++)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(files[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="file-input-使用技巧"><a href="#file-input-使用技巧" class="headerlink" title="file input 使用技巧"></a>file input 使用技巧</h2><p>说实在的，file <code>&lt;input /&gt;</code> 元素在页面展示的样子真不太好看。许多使用 file input 元素的 UI 组件是把这个元素隐藏掉了，然后通过一些技巧让文件上传组件变得漂亮起来。  </p>
<h3 id="通过-click-方法进行模拟"><a href="#通过-click-方法进行模拟" class="headerlink" title="通过 click() 方法进行模拟"></a>通过 click() 方法进行模拟</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">style</span>=<span class="string">"display: none;"</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"file-ipt"</span> <span class="attr">name</span>=<span class="string">"file"</span> <span class="attr">accept</span>=<span class="string">".jpg,.jpge,.gif,.png"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn"</span>&gt;</span>选择图片文件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> fileIpt = <span class="built_in">document</span>.querySelector(<span class="string">'#file-ipt'</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> btn = <span class="built_in">document</span>.querySelector(<span class="string">".btn"</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        btn.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">if</span>(fileIpt)&#123;</span></span><br><span class="line"><span class="actionscript">                <span class="comment">// 点击 button 后，相当于 fileIpt 被点击了</span></span></span><br><span class="line">                fileIpt.click();</span><br><span class="line">            &#125;</span><br><span class="line"><span class="actionscript">        &#125;,<span class="literal">false</span>);</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面代码运行后，点击 button 也会调出文件选择窗口。  </p>
<h3 id="使用-label-元素"><a href="#使用-label-元素" class="headerlink" title="使用 label 元素"></a>使用 label 元素</h3><p>label 元素可以和一个 <code>&lt;input&gt;</code> 元素关联在一起。你需要给 <code>&lt;input&gt;</code> 一个 id 属性。而 <code>&lt;label&gt;</code> 需要一个 <code>for</code> 属性，其值和 input 的 id 一样。  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"file-ipt"</span> <span class="attr">accept</span>=<span class="string">".png,.jpg"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"file-ipt"</span>&gt;</span>选择一张图片<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>运行上面代码，当点击 label 中的文字后，就会弹出文件选取框。使用 label 可以不用定义或模拟 click 事件。  </p>
<p>下面是一个用 CSS 优化后的 file input 组件。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"label-file"</span> <span class="attr">for</span>=<span class="string">"file-ipt"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"add"</span>&gt;</span>+<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"describe"</span>&gt;</span>Upload<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">style</span>=<span class="string">"display: none;"</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"file-ipt"</span> <span class="attr">name</span>=<span class="string">"file"</span> <span class="attr">accept</span>=<span class="string">".jpg,.jpge,.gif,.png"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="CSS-样式"><a href="#CSS-样式" class="headerlink" title="CSS 样式"></a>CSS 样式</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">*&#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wrapper</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">100px</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.label-file</span>&#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1.5px</span> dashed <span class="number">#999999</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#999999</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.label-file</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1.5px</span> dashed <span class="number">#1890ff</span>;</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">0.6s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.add</span>&#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">40px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.describe</span>&#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wrapper</span> <span class="selector-tag">p</span>&#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">6px</span> <span class="number">0px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fileIpt = <span class="built_in">document</span>.getElementById(<span class="string">"file-ipt"</span>);</span><br><span class="line"><span class="keyword">const</span> wrapper = <span class="built_in">document</span>.querySelector(<span class="string">".wrapper"</span>);</span><br><span class="line"></span><br><span class="line">fileIpt.addEventListener(<span class="string">'change'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> file = fileIpt.files[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">let</span> p = <span class="built_in">document</span>.createElement(<span class="string">"p"</span>),</span><br><span class="line">        name = file.name;</span><br><span class="line">    p.innerText = name;</span><br><span class="line">    wrapper.appendChild(p);</span><br><span class="line">&#125;,<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<h2 id="使用拖放来选取文件"><a href="#使用拖放来选取文件" class="headerlink" title="使用拖放来选取文件"></a>使用拖放来选取文件</h2><p>file input 元素默认支持拖放。而使用拖放来选取文件时，不一定要使用 file input。只要创建一个元素接收drop事件即可。  </p>
<p>还是上面的 HTML+CSS 解构。不过要添加鼠标拖拽事件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fileIpt = <span class="built_in">document</span>.getElementById(<span class="string">"file-ipt"</span>);</span><br><span class="line"><span class="keyword">const</span> wrapper = <span class="built_in">document</span>.querySelector(<span class="string">".wrapper"</span>);</span><br><span class="line"><span class="keyword">const</span> dropBox = <span class="built_in">document</span>.querySelector(<span class="string">".label-file"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主要是取消默认事件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drag</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    e.stopPropagation();</span><br><span class="line">    e.preventDefault();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleFiles</span>(<span class="params">files</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>;i &lt; files.length;i ++)&#123;</span><br><span class="line">        <span class="keyword">var</span> p = <span class="built_in">document</span>.createElement(<span class="string">"p"</span>);</span><br><span class="line">        p.innerText = files[i].name;</span><br><span class="line">        wrapper.appendChild(p);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 你也可以让 fileIpt 存入文件信息 </span></span><br><span class="line">    fileIpt.files = files;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 核心是这里</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drop</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    e.stopPropagation();</span><br><span class="line">    e.preventDefault();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 鼠标放下后，drop 事件触发</span></span><br><span class="line">    <span class="comment">// 这时可以获得文件信息</span></span><br><span class="line">    <span class="keyword">var</span> dt = e.dataTransfer;</span><br><span class="line">    <span class="keyword">var</span> files = dt.files;</span><br><span class="line"></span><br><span class="line">    handleFiles(files);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dropBox.addEventListener(<span class="string">"dragenter"</span>,drag,<span class="literal">false</span>);</span><br><span class="line">dropBox.addEventListener(<span class="string">"dragover"</span>,drag,<span class="literal">false</span>);</span><br><span class="line">dropBox.addEventListener(<span class="string">"drop"</span>, drop, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<h2 id="展示图片预览图"><a href="#展示图片预览图" class="headerlink" title="展示图片预览图"></a>展示图片预览图</h2><p>可以使用 <code>URL.createObjectURL()</code> 方法来实现。参数是一个用于创建 URL 的 <code>File</code> 对象、<code>Blob</code> 对象或者 <code>MediaSource</code> 的对象。<br>在上面代码的基础上，再添加以下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">fileIpt.onchange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> files = <span class="keyword">this</span>.files;</span><br><span class="line">    <span class="keyword">var</span> ul = <span class="built_in">document</span>.createElement(<span class="string">"ul"</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>;i &lt; files.length;i ++)&#123;</span><br><span class="line">        <span class="keyword">var</span> li = <span class="built_in">document</span>.createElement(<span class="string">"li"</span>);</span><br><span class="line">        li.classList.add(<span class="string">"imgWrapper"</span>);</span><br><span class="line">        ul.appendChild(li);</span><br><span class="line">        <span class="comment">// 实例化一个图片</span></span><br><span class="line">        <span class="keyword">var</span> image = <span class="keyword">new</span> Image(<span class="number">200</span>);</span><br><span class="line">        <span class="comment">// 让图片的 url 指向创建的文件 url</span></span><br><span class="line">        image.src = <span class="built_in">window</span>.URL.createObjectURL(files[i]);</span><br><span class="line"></span><br><span class="line">        image.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">window</span>.URL.revokeObjectURL(<span class="keyword">this</span>.src);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        li.appendChild(image);</span><br><span class="line">    &#125;</span><br><span class="line">    wrapper.appendChild(ul);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要注意的是，当不再需要这些 URL 对象时，每个对象必须通过调用 <code>URL.revokeObjectURL(src)</code> 方法来释放。浏览器会在文档退出的时候自动释放它们，但是为了获得最佳性能和内存使用状况，你应该在安全的时机主动释放掉它们。  </p>
<h3 id="使用-FileReader-创建预览图"><a href="#使用-FileReader-创建预览图" class="headerlink" title="使用 FileReader 创建预览图"></a>使用 FileReader 创建预览图</h3><p>这需要改写上面的 <code>fileIpt.onchange</code> 事件。 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">fileIpt.onchange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> files = <span class="keyword">this</span>.files;</span><br><span class="line">    <span class="keyword">var</span> ul = <span class="built_in">document</span>.createElement(<span class="string">"ul"</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>;i &lt; files.length;i ++)&#123;</span><br><span class="line">        <span class="keyword">var</span> li = <span class="built_in">document</span>.createElement(<span class="string">"li"</span>);</span><br><span class="line">        li.classList.add(<span class="string">"imgWrapper"</span>);</span><br><span class="line">        ul.appendChild(li);</span><br><span class="line">        <span class="keyword">var</span> image = <span class="keyword">new</span> Image(<span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">        li.appendChild(image);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 建立一个文件读取对象实例</span></span><br><span class="line">        <span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line">        reader.onload = (<span class="function"><span class="keyword">function</span>(<span class="params">aimg</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">                aimg.src = e.target.result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)(image);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将读取到的内容生成一个 url</span></span><br><span class="line">        reader.readAsDataURL(files[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    wrapper.appendChild(ul);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>reader.readAsDataURL(files[i])</code> 方法可以读取指定的 Blob 中的内容。一旦完成，result（e.target.result）属性中将包含一个 <strong>data: URL格式</strong> 的Base64字符串以表示所读取文件的内容。</p>
<h2 id="上传文件"><a href="#上传文件" class="headerlink" title="上传文件"></a>上传文件</h2><p>使用 <code>FormData</code>对象或者 <code>FileReader</code>可以实现文件上传，或者使用 HTML5 提供的 <code>FormData</code> 来实现。下面一一介绍这三个方法。  </p>
<h3 id="使用-FileReader-上传文件"><a href="#使用-FileReader-上传文件" class="headerlink" title="使用 FileReader 上传文件"></a>使用 FileReader 上传文件</h3><p>在展示图片预览图部分以及使用过 <code>FileReader</code> API。对于上传文件，可以使用 <code>FileReader</code> API 中的一个方法来实现文件上传的目的 —— <code>readAsBinaryString(blob)</code> 或者 <code>readAsArrayBuffer(blob)</code>。<code>readAsDataURL(file)</code> 方法可以给文件生成一个 URL，而 <code>readAsBinaryString</code> 方法可以读取指定的Blob中的内容。一旦完成，result属性中将包含所读取文件的原始二进制数据。而 <code>readAsArrayBuffer(blob)</code>可以读取指定的 Blob 或 File 内容，同时 result 属性中将包含一个 ArrayBuffer 对象以表示所读取文件的数据。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line"></span><br><span class="line">reader.readAsArrayBuffer(blob);</span><br><span class="line"></span><br><span class="line">reader.onload = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 获取读取的数据</span></span><br><span class="line">    <span class="keyword">var</span> data = e.target.result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面做一个文件上传的实例。  </p>
<p>HTML 骨架： </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- imgBoxs 存放上传图片（预览图）的容器 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"imgsBox"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- dropBox 选择文件的按钮 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"dropBox"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"file-ipt"</span> <span class="attr">name</span>=<span class="string">"file"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"add"</span>&gt;</span>+<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"describe"</span>&gt;</span>Upload<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./01.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>JavaScript 代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> imgsBox = <span class="built_in">document</span>.querySelector(<span class="string">".imgsBox"</span>);</span><br><span class="line"><span class="keyword">const</span> dropBox = <span class="built_in">document</span>.querySelector(<span class="string">".dropBox"</span>);</span><br><span class="line"><span class="keyword">const</span> fileIpt = <span class="built_in">document</span>.querySelector(<span class="string">"#file-ipt"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Ajax 封装函数</span></span><br><span class="line"><span class="comment"> * @param &#123;XMLHttpRequest&#125; xhr</span></span><br><span class="line"><span class="comment"> * @param &#123;string&#125; method</span></span><br><span class="line"><span class="comment"> * @param &#123;string&#125; url</span></span><br><span class="line"><span class="comment"> * @param &#123;Object&#125; data</span></span><br><span class="line"><span class="comment"> * @param &#123;JSON&#125; headers</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">xhr,method = <span class="string">"GET"</span>,url,data = <span class="string">''</span>,headers = &#123;&#125;</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">        xhr.open(method, url);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> p <span class="keyword">in</span> headers)&#123;</span><br><span class="line">            xhr.setRequestHeader(p,headers[p]);</span><br><span class="line">        &#125;</span><br><span class="line">        xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(xhr.readyState === <span class="number">4</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(xhr.status === <span class="number">200</span> || xhr.status === <span class="number">304</span>)&#123;</span><br><span class="line">                    resolve(xhr.response);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    reject(<span class="string">"Warning!"</span>,xhr.status);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        xhr.send(data);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 上传文件</span></span><br><span class="line"><span class="comment"> * @param &#123;JSON&#125; data </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">uploadFile</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    <span class="comment">// 监听上传进度</span></span><br><span class="line">    xhr.upload.addEventListener(<span class="string">"progress"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (e.lengthComputable)&#123;</span><br><span class="line">            <span class="built_in">console</span>.log((e.loaded * <span class="number">100</span> / e.total).toFixed(<span class="number">2</span>) + <span class="string">"%"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// 上传完毕后的事件函数</span></span><br><span class="line">    xhr.upload.addEventListener(<span class="string">"load"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"上传完毕!"</span>);</span><br><span class="line">    &#125;,<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// 接收响应数据</span></span><br><span class="line">    <span class="keyword">var</span> result = ajax(xhr, <span class="string">"POST"</span>, <span class="string">"/file.php"</span>, data);</span><br><span class="line"></span><br><span class="line">    result.then(<span class="function">(<span class="params">data</span>) =&gt;</span> <span class="built_in">console</span>.log(data));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 展示预览图</span></span><br><span class="line"><span class="comment"> * @param &#123;string&#125; imgURL</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createImage</span>(<span class="params">imgURL</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>),</span><br><span class="line">        box = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</span><br><span class="line">        img = <span class="built_in">document</span>.createElement(<span class="string">"img"</span>),</span><br><span class="line">    div.classList.add(<span class="string">"imgWrapper"</span>);</span><br><span class="line">    box.classList.add(<span class="string">"imgBox"</span>);</span><br><span class="line"></span><br><span class="line">    img.src = imgURL;</span><br><span class="line">    box.appendChild(img);</span><br><span class="line">    div.appendChild(box);</span><br><span class="line"></span><br><span class="line">    img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(img.height &lt; img.width || img.height === img.width)</span><br><span class="line">            img.style.height = <span class="string">"100%"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            img.style.width = <span class="string">"100%"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    imgsBox.insertBefore(div,dropBox);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理文件对象</span></span><br><span class="line"><span class="comment"> * @param &#123;File&#125; file</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleFiles</span>(<span class="params">file</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name = file.name,</span><br><span class="line">        reader = <span class="keyword">new</span> FileReader(),</span><br><span class="line">        showImgReader = <span class="keyword">new</span> FileReader();</span><br><span class="line"></span><br><span class="line">    showImgReader.onload = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">        createImage(e.target.result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    reader.onload = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">        uploadFile(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">            name,</span><br><span class="line">            file: e.target.result,</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">    reader.readAsBinaryString(file);</span><br><span class="line">    showImgReader.readAsDataURL(file);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * file change 事件触发</span></span><br><span class="line"><span class="comment"> * @param &#123;Event&#125; e </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fileChange</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> fileList = <span class="keyword">this</span>.files || e.target.files;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>;i &lt; fileList.length;i ++)&#123;</span><br><span class="line">        handleFiles(fileList[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fileIpt.addEventListener(<span class="string">"change"</span>,fileChange,<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p>CSS 样式：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">*&#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.wrapper</span>&#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#dddddd</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">100px</span> auto;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.imgsBox</span>&#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">60px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">360px</span>;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    <span class="attribute">grid-template-columns</span>: <span class="number">1</span>fr <span class="number">1</span>fr <span class="number">1</span>fr;</span><br><span class="line">    <span class="attribute">grid-template-rows</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.dropBox</span>&#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1.5px</span> dashed <span class="number">#999999</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">6px</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.dropBox</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1.5px</span> dashed <span class="number">#1890ff</span>;</span><br><span class="line">    <span class="attribute">transition</span>: border .<span class="number">6s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#file-ipt</span>&#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.dropBox</span> <span class="selector-class">.add</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#999999</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.dropBox</span> <span class="selector-class">.describe</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#999999</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.imgWrapper</span>&#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">90px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">90px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">background-position</span>: center;</span><br><span class="line">    <span class="attribute">background-size</span>: cover;</span><br><span class="line">    <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">background-color</span>: white;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#cccccc</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0px</span> <span class="number">10px</span> <span class="number">10px</span> <span class="number">0px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.imgWrapper</span> <span class="selector-class">.imgBox</span>&#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面代码中，使用了 <code>FileReader</code> 处理文件数据，并发送 POST 请求，上传了 JSON 数据，数据包含文件名和文件本体数据。</p>
<p>使用 Node.js 做后端处理：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(req.url === <span class="string">"/file.php"</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> data = [];</span><br><span class="line">        <span class="comment">// 监听请求数据</span></span><br><span class="line">        req.on(<span class="string">'data'</span>,(chunk) =&gt; &#123;</span><br><span class="line">            data.push(chunk);</span><br><span class="line">        &#125;);</span><br><span class="line">        req.on(<span class="string">'end'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="comment">// 拿到数据</span></span><br><span class="line">            <span class="keyword">var</span> object = <span class="built_in">JSON</span>.parse(Buffer.concat(data).toString());</span><br><span class="line">            <span class="comment">// 写入操作</span></span><br><span class="line">            fs.writeFileSync(<span class="string">`./<span class="subst">$&#123;object.name&#125;</span>`</span>,object.file,&#123;<span class="attr">encoding</span>: <span class="string">'binary'</span>&#125;);</span><br><span class="line">            <span class="comment">// 返回相应信息</span></span><br><span class="line">            res.setHeader(<span class="string">"Content-Type"</span>,<span class="string">"text/plain"</span>);</span><br><span class="line">            res.end(<span class="string">'&#123;"status": "seccess"&#125;'</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 路由处理</span></span><br><span class="line">    <span class="keyword">if</span>(req.url === <span class="string">"/"</span>)&#123;</span><br><span class="line">        res.writeHead(<span class="number">200</span>,&#123;</span><br><span class="line">            <span class="string">"Content-Type"</span>: <span class="string">"text/html"</span></span><br><span class="line">        &#125;);</span><br><span class="line">        res.end(fs.readFileSync(<span class="string">"./01.html"</span>,&#123;<span class="attr">encoding</span>: <span class="string">"utf8"</span>&#125;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(req.url === <span class="string">"/01.js"</span>)&#123;</span><br><span class="line">        res.writeHead(<span class="number">200</span>,&#123;</span><br><span class="line">            <span class="string">"Content-Type"</span>: <span class="string">"text/javascript"</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        res.end(fs.readFileSync(<span class="string">'./01.js'</span>,&#123;<span class="attr">encoding</span>: <span class="string">'utf8'</span>&#125;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).listen(<span class="number">4000</span>,() =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"server is running: http://localhost:4000"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>当然，也可以使用 <code>readAsArrayBuffer(file)</code> 方法去读取文件然后发送请求。需要注意的是，该方法会生成 <code>ArrayBuffer</code> 数据。而 <code>ArrayBuffer</code> 数据是不允许进行修改的。也就是说，你不能向上面一样使用 <code>upload(JSON.stringify({name,file}))</code> 去发送数据，因为使用了 <code>JSON.stringify</code> 方法操作了 <code>ArrayBuffer</code>数据。你只能直接进行数据发送：<code>upload(e.target.result)</code>。</p>
<p>Node.js 服务端接收 <code>ArrayBuffer</code> 数据时，只需 <code>Buffer.concat(data)</code> 然后进行文件写入即可。该方法不足的是，你无法一次发送数据就能获知发送文件的一些信息，比如文件后缀和文件名，不知道文件后缀就不太好生成正确的文件。当然，可以发送两波请求，一波是文件数据，一波是文件信息。  </p>
<h3 id="模拟进度条"><a href="#模拟进度条" class="headerlink" title="模拟进度条"></a>模拟进度条</h3><p>很多文件上传或下载场景中都有下载/上传进度信息，通常用一个进度条来描述。XMLHttpRequest 实例的 upload 对象中可以监听 <code>progress</code> 来监听文件上传/下载的进度。<code>load</code> 方法表示文件上传/下载完成。下面的代码会打印出文件上传时的上传进度。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">xhr.upload.addEventListener(<span class="string">"progress"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (e.lengthComputable)&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * lengthComputable 它告诉进度是否可测量（布尔类型）。默认为 false</span></span><br><span class="line"><span class="comment">         * loaded     它表示已上传的工作量（数字类型）</span></span><br><span class="line"><span class="comment">         * total      它表示总的工作量数（数字类型）</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="built_in">console</span>.log((e.loaded * <span class="number">100</span> / e.total).toFixed(<span class="number">2</span>) + <span class="string">"%"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p>完整代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建一个元素</span></span><br><span class="line"><span class="comment"> * @param &#123;string&#125; tagName</span></span><br><span class="line"><span class="comment"> * @param &#123;string&#125; content</span></span><br><span class="line"><span class="comment"> * @param &#123;string&#125; className</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createElem</span>(<span class="params">tagName,content,className</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> tag = <span class="built_in">document</span>.createElement(tagName);</span><br><span class="line">    tag.innerHTML = content || <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">if</span>(className)</span><br><span class="line">        tag.classList.add(className);</span><br><span class="line">    <span class="keyword">return</span> tag;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将多个元素插入到一个元素中</span></span><br><span class="line"><span class="comment"> * @param &#123;Element&#125; parent</span></span><br><span class="line"><span class="comment"> * @param &#123;Array &lt;Element&gt;&#125; elems</span></span><br><span class="line"><span class="comment"> * number 值是 0 时，append 插入，值是 1 时，insertBefore 插入</span></span><br><span class="line"><span class="comment"> * @param &#123;number&#125; position</span></span><br><span class="line"><span class="comment"> * 当是 insertBefore 时，需要传入指定的元素</span></span><br><span class="line"><span class="comment"> * @param &#123;Element&#125; oldElem</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">appendElems</span>(<span class="params">parent,elems,position,oldElem</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(position)&#123;</span><br><span class="line">        elems.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">            parent.insertBefore(item,oldElem);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        elems.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">            parent.appendChild(item);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 上传事件发生时的函数</span></span><br><span class="line"><span class="comment"> * @param &#123;Event&#125; e</span></span><br><span class="line"><span class="comment"> * @param &#123;Object &lt;Element&gt;&#125; elems</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">progressAnimation</span>(<span class="params">e,elems</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; div,describe,progressNum,loadBox,loadBar &#125; = elems;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (e.lengthComputable) &#123;</span><br><span class="line">        loadBar.style.width = <span class="string">"0px"</span>;</span><br><span class="line">        imgsBox.insertBefore(div,dropBox);</span><br><span class="line">        appendElems(div, [progressNum, loadBox, describe]);</span><br><span class="line">        loadBox.appendChild(loadBar);</span><br><span class="line"></span><br><span class="line">        describe.innerText = <span class="string">"Upload..."</span>;</span><br><span class="line">        <span class="keyword">const</span> bar_W = <span class="built_in">parseInt</span>(<span class="built_in">window</span>.getComputedStyle(loadBox,<span class="literal">null</span>).width);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> num = (e.loaded * <span class="number">100</span> / e.total).toFixed(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span>(num &gt;= <span class="number">90</span>)&#123;</span><br><span class="line">            loadBar.style.backgroundColor = <span class="string">"greenyellow"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        loadBar.style.width = num * (bar_W / <span class="number">100</span>) + <span class="string">'px'</span>;</span><br><span class="line">        progressNum.innerText = num + <span class="string">"%"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadAnimation</span>(<span class="params">loadWrapper</span>)</span>&#123;</span><br><span class="line">    loadWrapper.style.display = <span class="string">"none"</span>;</span><br><span class="line">    loadWrapper.previousElementSibling.style.display = <span class="string">"flex"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 上传文件</span></span><br><span class="line"><span class="comment"> * @param &#123;JSON&#125; data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">uploadFile</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    <span class="keyword">var</span> elems = &#123;</span><br><span class="line">        div: createElem(<span class="string">"div"</span>, <span class="string">''</span>, <span class="string">'loadWrapper'</span>),</span><br><span class="line">        describe: createElem(<span class="string">"span"</span>, <span class="string">'正在上传...'</span>, <span class="string">'describe'</span>),</span><br><span class="line">        progressNum: createElem(<span class="string">"span"</span>, <span class="string">'0%'</span>, <span class="string">".progressNum"</span>),</span><br><span class="line">        loadBox: createElem(<span class="string">"div"</span>, <span class="string">''</span>, <span class="string">'loadBox'</span>),</span><br><span class="line">        loadBar: createElem(<span class="string">"div"</span>, <span class="string">''</span>, <span class="string">'loadBar'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    xhr.upload.addEventListener(<span class="string">"progress"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">        progressAnimation.call(<span class="keyword">this</span>,e,elems);</span><br><span class="line">    &#125;,<span class="literal">false</span>);</span><br><span class="line">    xhr.upload.addEventListener(<span class="string">"load"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        loadAnimation.call(<span class="keyword">this</span>,elems.div);</span><br><span class="line">    &#125;,<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">var</span> result = ajax(xhr, <span class="string">"POST"</span>, <span class="string">"/file.php"</span>, data);</span><br><span class="line"></span><br><span class="line">    result.then(<span class="function">(<span class="params">data</span>) =&gt;</span> <span class="built_in">console</span>.log(data));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 展示预览图</span></span><br><span class="line"><span class="comment"> * @param &#123;string&#125; imgURL</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createImage</span>(<span class="params">imgURL</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>),</span><br><span class="line">        box = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>),</span><br><span class="line">        img = <span class="built_in">document</span>.createElement(<span class="string">"img"</span>);</span><br><span class="line">    div.classList.add(<span class="string">"imgWrapper"</span>);</span><br><span class="line">    box.classList.add(<span class="string">"imgBox"</span>);</span><br><span class="line"></span><br><span class="line">    img.src = imgURL;</span><br><span class="line">    box.appendChild(img);</span><br><span class="line">    div.appendChild(box);</span><br><span class="line"></span><br><span class="line">    img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(img.height &lt; img.width || img.height === img.width)</span><br><span class="line">            img.style.height = <span class="string">"100%"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            img.style.width = <span class="string">"100%"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    imgsBox.insertBefore(div,dropBox);</span><br><span class="line">    div.style.display = <span class="string">"none"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CSS 展示文件上传进度</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.loadWrapper</span>&#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background</span>: white;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#cccccc</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.loadWrapper</span> <span class="selector-class">.describe</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#999999</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.loadWrapper</span> <span class="selector-class">.progressNum</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: orangered;</span><br><span class="line">    <span class="attribute">font-weight</span>: bold;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.loadWrapper</span> <span class="selector-class">.loadBox</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">80px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#cccccc</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">6px</span> <span class="number">0px</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.loadWrapper</span> <span class="selector-class">.loadBox</span> <span class="selector-class">.loadBar</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">background</span>: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用-FormData-实现文件上传"><a href="#使用-FormData-实现文件上传" class="headerlink" title="使用 FormData 实现文件上传"></a>使用 FormData 实现文件上传</h3><p><code>FormData</code> 是 HTML5 的一个 API。下面就是使用 <code>FormData</code> 进行提交表单的例子。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"form"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">action</span>=<span class="string">"/form.php"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">required</span> <span class="attr">class</span>=<span class="string">"name-ipt"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">type</span>=<span class="string">"text"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        password: <span class="tag">&lt;<span class="name">input</span> <span class="attr">required</span> <span class="attr">class</span>=<span class="string">"psd-ipt"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">type</span>=<span class="string">"password"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"submitBtn"</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> form = <span class="built_in">document</span>.getElementById(<span class="string">"form"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> submitBtn = <span class="built_in">document</span>.getElementsByClassName(<span class="string">"submitBtn"</span>)[<span class="number">0</span>];</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// 把 from 表单元素传给 FormData 类</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> formData = <span class="keyword">new</span> FormData(form);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="title">ajax</span><span class="params">(xhr, method = <span class="string">"GET"</span>, url, data = <span class="string">""</span>, headers = &#123;&#125;)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line">                xhr.open(method, url);</span><br><span class="line"><span class="actionscript">                xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                    <span class="keyword">if</span> (<span class="keyword">this</span>.readyState === <span class="number">4</span>) &#123;</span></span><br><span class="line"><span class="actionscript">                        <span class="keyword">if</span> (<span class="keyword">this</span>.status === <span class="number">200</span> || <span class="keyword">this</span>.status === <span class="number">304</span>) &#123;</span></span><br><span class="line"><span class="actionscript">                            resolve(<span class="keyword">this</span>.response);</span></span><br><span class="line"><span class="actionscript">                        &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="actionscript">                            reject(<span class="string">"Warnning!"</span>,<span class="keyword">this</span>.status);</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"><span class="javascript">                <span class="keyword">for</span>(<span class="keyword">let</span> p <span class="keyword">in</span> headers)&#123;</span></span><br><span class="line">                    xhr.setRequestHeader(p,headers[p]);</span><br><span class="line">                &#125;</span><br><span class="line">                xhr.send(data);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">        submitBtn.addEventListener(<span class="string">"click"</span>, <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">            <span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> res = <span class="keyword">await</span> ajax(</span></span><br><span class="line">                xhr,</span><br><span class="line"><span class="actionscript">                <span class="string">"POST"</span>,</span></span><br><span class="line">                form.action,</span><br><span class="line"><span class="actionscript">                <span class="comment">// 发送的数据是得到的 FormData 实例 </span></span></span><br><span class="line">                formData</span><br><span class="line">            );</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(res);</span></span><br><span class="line"><span class="actionscript">        &#125;, <span class="literal">false</span>);</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>FormData</code> 实例是一个 Map。里面有 <code>append</code>、<code>delete</code>、<code>has</code> 等方法。</p>
<p>需要注意的是，使用 <code>FormData</code> 时，form 元素应增加一个属性：<code>enctype=&quot;multipart/form-data&quot;</code>。不添加的话，生成的数据是 <code>key=value</code> 形式的数据，而且当有 file input 时，文件内容不会被上传。  </p>
<p>如果不使用 form 元素进行包裹，可以使用 <code>formData.append()</code> 方法进行添加数据。<code>append()</code>方法接收两个参数，第一个参数是数据，可以是一个字符串，也可以是 blob 对象，file 数据就属于 blob。第二个参数是可选的，表示数据的文件名，是一个字符串。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> file = <span class="built_in">document</span>.getElementById(<span class="string">"file-ipt"</span>);</span><br><span class="line"></span><br><span class="line">formData.append(file.files[<span class="number">0</span>]);     <span class="comment">// 添加数据</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/10/23/readme/" data-id="ck22oogqa00011wii5jq755cb" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2019/10/23/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/10/23/readme/">readme</a>
          </li>
        
          <li>
            <a href="/2019/10/23/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>